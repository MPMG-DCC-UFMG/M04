{
  "spark_fractal": [
    {
      "name": "spark.master",
      "value": "local[*]"
    },
    { 
      "name": "spark.driver.host",
      "value": "10.21.0.127"
    },
    { 
      "name": "spark.driver.memory",
      "value": "200g"
    },
    { 
      "name": "spark.executor.cores",
      "value": "5"
    },
    { 
      "name": "spark.executor.instances",
      "value": "4"
    },
    { 
      "name": "spark.executor.memory",
      "value": "40g"
    }
  ],
  "spark_database": [
    {
      "name": "spark.master",
      "value": "yarn"
    },
    {
      "name": "spark.driver.host",
      "value": "10.21.0.127"
    },
    {
      "name": "spark.executor.memory",
      "value": "6g"
    },
    {
      "name": "spark.hadoop.hive.llap.daemon.service.hosts",
      "value": "@llap0"
    },
    {
      "name": "spark.sql.hive.hiveserver2.jdbc.url",
      "value": "jdbc:hive2://hadoopmn-gsi-prod01.mpmg.mp.br:2181,hadoopmn-gsi-prod02.mpmg.mp.br:2181,hadoopmn-gsi-prod03.mpmg.mp.br:2181/dataset;serviceDiscoveryMode=zooKeeper;zooKeeperNamespace=hiveserver2;AuthMech=3;password=UFMGtrilhas2020;user=trilhasgsi"
    },
    {
      "name": "spark.datasource.hive.warehouse.exec.results.max",
      "value": "2147483647"
    }
  ],
  "app": {
    "name" : "read_database",
    "query": "WITH licitantes_dim_habilitado as ( select distinct num_cpf_cnpj_show as num_cpf_cnpj, h.nome_pessoa_show , h.id_licitacao, h.id_hab_licitacao, h.ano_referencia, h.mes_referencia from dataset_v2.sicom_20210109_licitacao_habilitado h where h.cod_tipo_pessoa = 'J'), licitantes_e_socios as ( select A.num_cpf_cnpj as licitante, A.id_licitacao, A.id_hab_licitacao, A.ano_referencia, A.mes_referencia, CASE when B.num_cpf_cnpj_show != '00000000000000' and B.num_cpf_cnpj_show != '000DOCINVALIDO' THEN B.num_cpf_cnpj_show ELSE A.num_cpf_cnpj END AS num_cpf_cnpj_socio, CASE when B.num_cpf_cnpj_show != '00000000000000' and B.num_cpf_cnpj_show != '000DOCINVALIDO' THEN B.nome_pessoa_show ELSE A.nome_pessoa_show END AS nome_socio, B.cod_tipo_pessoa from licitantes_dim_habilitado A inner join dataset_v2.sicom_20210109_licitacao_quadro_societario B ON  (A.id_hab_licitacao = B.id_hab_licitacao) AND (A.num_cpf_cnpj != B.num_cpf_cnpj_show) ), socios_pj as ( select distinct num_cpf_cnpj_socio as cnpj_nos, id_licitacao , id_hab_licitacao, ano_referencia, mes_referencia from licitantes_e_socios where cod_tipo_pessoa = 'J'), uniao_licitantes_e_socios as ( select licitante as cnpj_nos, id_licitacao, id_hab_licitacao, ano_referencia, mes_referencia from licitantes_e_socios union select cnpj_nos as cnpj_nos , id_licitacao, id_hab_licitacao, ano_referencia, mes_referencia        from socios_pj), uniao_licitantes_e_socios_c_rfb_soc as ( select A.cnpj_nos as cnpj_nos, A.id_licitacao, A.ano_referencia, A.mes_referencia,        B.num_cpf_cnpj_show as num_cpf_cnpj_socio, B.nome_pessoa_show as nome_socio from uniao_licitantes_e_socios A inner join dataset_v2.sicom_20210109_licitacao_quadro_societario B on (A.id_hab_licitacao = B.id_hab_licitacao)) ( select DISTINCT A.cnpj_nos cnpj1, B.cnpj_nos cnpj2, A.ano_referencia, A.mes_referencia, A.id_licitacao from uniao_licitantes_e_socios_c_rfb_soc A join uniao_licitantes_e_socios_c_rfb_soc B where (A.num_cpf_cnpj_socio = B.num_cpf_cnpj_socio) and (A.nome_socio = B.nome_socio) and (A.id_licitacao = B.id_licitacao) and (A.cnpj_nos != B.cnpj_nos) order by cnpj1, ano_referencia, mes_referencia, A.id_licitacao, cnpj2)",
    "output_path": "hdfs://hadoopgsiha/dados-fractal/read-database-licitacao-socios-em-comum.csv",
    "delimiter" : ";",
    "show_header": "true"	
  }
}
